name: Deploy UAT to cPanel

on:
  push:
    branches:
      - uat  # <--- à§§. à¦¶à§à¦§à§ uat à¦¬à§à¦°à¦¾à¦žà§à¦šà§‡ à¦ªà§à¦¶ à¦•à¦°à¦²à§‡ à¦à¦Ÿà¦¿ à¦šà¦¾à¦²à§ à¦¹à¦¬à§‡

jobs:
  web-deploy:
    name: ðŸš§ Build and Deploy UAT
    runs-on: ubuntu-latest

    steps:
      - name: ðŸšš Get latest code
        uses: actions/checkout@v4

      - name: ðŸŸ¢ Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'
          extensions: mbstring, xml, ctype, iconv, intl, pdo_mysql, dom, filter, gd, json, zip
          tools: composer:v2

      # UAT à¦¤à§‡à¦“ à¦ªà§à¦°à§‹à¦¡à¦¾à¦•à¦¶à¦¨à§‡à¦° à¦®à¦¤à§‹à¦‡ à¦ªà¦°à¦¿à¦¬à§‡à¦¶ à¦°à¦¾à¦–à¦¾ à¦¹à¦²à§‹ (no-dev)
      - name: ðŸ“¦ Install Composer Dependencies
        run: composer install --no-dev --optimize-autoloader --prefer-dist --no-interaction --no-progress

      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install NPM Dependencies
        run: npm install

      - name: âš™ï¸ Build Assets (Vite)
        run: npm run build

      # ðŸš€ à¦«à¦¾à¦‡à¦² à¦†à¦ªà¦²à§‹à¦¡ à¦¸à§‡à¦•à¦¶à¦¨ (UAT)
      - name: ðŸ“‚ Deploy to UAT Folder via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          
          # ðŸ‘‡ à§¨. à¦à¦–à¦¾à¦¨à§‡ à¦«à§‹à¦²à§à¦¡à¦¾à¦°à§‡à¦° à¦¨à¦¾à¦® à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨ à¦•à¦°à¦¾ à¦¹à¦¯à¦¼à§‡à¦›à§‡
          server-dir: /uat.rollershuttersingapore.com/
          
          protocol: ftp
          port: 21
          security: loose
          
          # à¦­à¦¾à¦°à§€ à¦«à§‹à¦²à§à¦¡à¦¾à¦° à¦à¦¬à¦‚ à¦à¦¨à¦­à¦¾à¦¯à¦¼à¦°à¦¨à¦®à§‡à¦¨à§à¦Ÿ à¦«à¦¾à¦‡à¦² à¦¬à¦¾à¦¦ à¦¦à§‡à¦“à¦¯à¦¼à¦¾ à¦¹à¦¯à¦¼à§‡à¦›à§‡ (à¦†à¦—à§‡à¦° à¦®à¦¤à§‹à¦‡)
          exclude: |
            **/.git*
            **/.git*/**
            **/.github/**
            **/node_modules/**
            **/vendor/**
            **/tests/**
            **/.env
            **/storage/*.key
            **/storage/framework/cache/**
            **/storage/framework/sessions/**
            **/storage/framework/views/**
            **/storage/logs/**
            **/README.md
